/*! angular-thickm 0.4.0-beta.2 10-11-2014 */
!function(){"use strict";angular.module("thickm.collection",["thickm.util"]),angular.module("thickm.model",["thickm.collection","thickm.util"]),angular.module("thickm",["thickm.model","thickm.collection"]),angular.module("thickm.util",[]),angular.module("thickm.model").provider("ThickModel",function(){function a(a){return a.success=function(b){return a.then(function(a){b(a)}),a},a.error=function(b){return a.then(null,function(a){b(a)}),a},a}var b=this;this.headers={post:{"Content-Type":"application/json"},put:{"Content-Type":"application/json"},patch:{"Content-Type":"application/json"},"delete":{"Content-Type":"application/json"}},this.$get=function(c,d,e,f){function g(a){angular.extend(this,a),Object.defineProperty(this,"_original",{enumerable:!1,writable:!0}),this.setOriginal()}return g.prototype._baseUrl="",g.prototype._modelName="items",g.prototype._primaryField="id",g._collectionClass=e,g.build=function(a){return new this(a)},g.prototype.getCollectionUrl=function(){return(this._baseUrl||"/")+this._modelName},g.prototype.getModelUrl=function(a){return this.getCollectionUrl()+"/"+(a||this[this._primaryField])},g.transformCollectionResponse=function(a){return this._collectionClass.build(this,a)},g.transformItemResponse=function(a){return this.build(a.data)},g.prototype.transformItemRequest=function(){return this.isNew()?this:this.diff()},g.queryUrl=function(b,d){var e=this,f=c.get(b,d?{params:d}:void 0).then(function(a){return e.transformCollectionResponse(a)});return a(f)},g.query=function(a){return this.queryUrl(this.prototype.getCollectionUrl(),a)},g.getUrl=function(b,d){var e=this,f=c.get(b,d?{params:d}:void 0).then(function(a){return e.transformItemResponse(a)});return a(f)},g.get=function(a,b){return this.getUrl(this.prototype.getModelUrl(a),b)},g.prototype.isNew=function(){return!(this._primaryField in this&&angular.isDefined(this[this._primaryField]))},g.prototype.setOriginal=function(){this._original=angular.copy(this)},g.prototype.diff=function(){if(!angular.isObject(this._original))return this;var a={},b=this;return Object.keys(this).forEach(function(c){angular.equals(b._original[c],b[c])||(a[c]=b[c])}),a},g.prototype.update=function(a){a||(a={}),angular.extend(this,a)},g.prototype.save=function(){var d,e=this,f=this.isNew(),g={};g.headers=angular.copy(f?b.headers.post:b.headers.patch);var h=this.transformItemRequest(g.headers);return d=this.isNew()?c.post(this.getCollectionUrl(),h,g):c.patch(this.getModelUrl(),h,g),d.then(function(a){e.update(a.data)}),a(d)},g.prototype.delete=function(){if(this.isNew()){var e=d.defer();return e.resolve({}),a(e.promise)}var f={};return f.headers=angular.copy(b.headers.delete),this.transformItemRequest(f.headers),a(c.delete(this.getModelUrl(),f))},g.extend=function(a){f.extend(a,this),angular.extend(a,this)},g}}),angular.module("thickm.collection").factory("ThickModelCollection",function(a){function b(){Array.apply(this,arguments)}return a.extend(b,Array),b._itemsField=null,b._metaField="meta",b.itemsFromResponse=function(a,b){var c=this._itemsField?b.data[this._itemsField]:b.data;return c.map(function(b){return a.build(b)})},b.metaFromResponse=function(a,b){return this._metaField?b.data[this._metaField]:{}},b.build=function(a,b){var c=new this;c._modelClass=a;var d=this.itemsFromResponse(a,b);return angular.forEach(d,function(a){c.push(a)}),c._meta=this.metaFromResponse(a,b),c},b.extend=function(b){a.extend(b,this),angular.extend(b,this)},b.prototype.toArray=function(){return this.map(angular.identity)},b}),angular.module("thickm.util").factory("ThickmUtil",function(){function a(a,b){var c=function(){};c.prototype=b.prototype,a.prototype=new c,a.prototype.constructor=a}return{extend:a}})}(window,document);